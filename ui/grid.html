<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Webstellation</title>
    <link href="webfonts/fontawesome.min.css" rel="stylesheet">
    <link href="webfonts/solid.min.css" rel="stylesheet">
    <script src="jquery/2.1.0/jquery.min.js"></script>
    <script src="w2ui/1.5.rc1/w2ui.min.js"></script>
    <link rel="stylesheet" type="text/css" href="w2ui/1.5.rc1/w2ui.min.css" />
    <style>
      .w2ui-icon.links {
      background-repeat: no-repeat;
      background-image: url(icons/links.png);
      }
      .w2ui-icon.nodes {
      background-repeat: no-repeat;
      background-image: url(icons/nodes.png);
      }
    </style>
  </head>

  <body>
    <div id="main" style="position: absolute; top: 0px; left: 0px; bottom: 0px; right: 0px;"></div>

    <script type="text/javascript">
      'use strict';

      const selectId = function(id) {
        w2ui['sidebar'].select(id);
        w2ui['grid'].selectNone();
        w2ui['grid'].select(id);
      }

      const unselect = function() {
        w2ui['sidebar'].unselect();
        w2ui['grid'].selectNone();
      }

      const pstyle = 'border: 1px solid #dfdfdf; padding: 5px;';
      // var pstyle = 'border: 1px solid #00ff00; padding: 5px;';
      const config = {
        layout: {
          name: 'layout',
          padding: 1,
          panels: [
              { type: 'top', size: 36, resizable: false, style: pstyle, content: 'top' },
              { type: 'left', size: 192, resizable: true, style: pstyle, content: 'left' },
              { type: 'main', style: pstyle, content: 'main <i class="fas fa-camera"></i>' },
              { type: 'bottom', size: 200, resizable: true, style:pstyle, content: 'data' }
          ]
        },
        toolbar: {
          name: 'toolbar',
          items: [
              { type: 'button', id: 'reset', text: 'Reset graph', icon: 'fas fa-sync' },
              { type: 'break' },
              { type: 'check', id: 'item3', text: 'Check 1'},//, icon: 'fas fa-star' },
              { type: 'check', id: 'item4', text: 'Check 2', icon: 'fas fa-heart' },
              { type: 'break' },
              { type: 'radio', id: 'item5', group: '1', text: 'Radio 1', icon: 'fas fa-star', checked: true },
              { type: 'radio', id: 'item6', group: '1', text: 'Radio 2', icon: 'fas fa-heart' },
              { type: 'spacer' },
              { type: 'button', id: 'item7', text: 'Button', icon: 'fas fa-star' }
          ],
          onClick: function (event) {
              console.log('Target: '+ event.target, event);
              switch(event.target) {
                case 'reset':
                  unselect();
                  break;
                default:
                  console.log(`Unknonw target: ${event.target}`);
              }
          }
        },
        sidebar: {
          name: 'sidebar',
          nodes: [
              // { id: 'general', text: 'Graph', group: true, expanded: true, nodes: [
              //     { id: 'vxs', text: 'Nodes', img: 'nodes', expanded: true, selected: false,
              //       nodes: [{id:'aaa', text:'aaa', icon: 'fas fa-sync'}, {id:'bbb', text:'BBB'}] },
              //     { id: 'txs', text: 'Links', img: 'links', expanded: true, nodes: [{id:'zzz', text:'zzz', icon: 'fas fa-sync'}] }
              // ]}
          ],
          onClick: function(event) {
            console.log(event);
            selectId(event.target);
          }
        },
        grid: {
          name: 'grid',
          onClick: function(event) {
            console.log(event);
            selectId(event.recid);
          }
        }
      };

      $(function () {
        // initialization
        $('#main').w2layout(config.layout);
        w2ui.layout.html('top', $().w2toolbar(config.toolbar));
        w2ui.layout.html('left', $().w2sidebar(config.sidebar));
        w2ui.layout.html('bottom', $().w2grid(config.grid));
        // w2ui.layout.content('main', $().w2grid(config.grid1));
        // in memory initialization
        // $().w2grid(config.grid2);
      });

      const params = new URLSearchParams(document.location.search.substring(1));
      let graphName = params.get('graph');
      if(!graphName) {
        graphName = 'graph-5.json'
      }
      console.log(`Graph file: ${graphName}`)

      fetch(graphName)
        .then(response => response.json())
        .then(data => {
          // Which attributes are used for the label and node color attributes?
          //
          const label_attr = data.label_attr;
          const node_color_attr = data.node_color_attr;

          // Build the list.
          //
          data.vx_noted.forEach(id => {
            const vx = data.vertex[id];
            const item = {id:id, text: vx[label_attr], img: 'nodes' };
            // console.log(w2ui['sidebar'].get('vxs').nodes);
            w2ui['sidebar'].nodes.push(item);
          });
          w2ui['sidebar'].refresh();

          // Build the grid.
          //
          for(const attr of data.ui_attrs) {
            console.log(`attr: ${attr}`);
            w2ui['grid'].addColumn({field:attr, text:attr});
          }

          const rows = [];
          for(const [id, vx] of Object.entries(data.vertex)) {
            // w2ui.grid uses 'recid' as the default unique row identifier.
            //
            const row = {recid:id};
            for(const attr of data.ui_attrs) {
              row[attr] = vx[attr];
            }
            console.log(row);
            rows.push(row);
          }
          w2ui['grid'].add(rows);
        }
      );
    </script>

  </body>
</html>
